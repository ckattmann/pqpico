<html>

<head>
    <meta charset="UTF-8">
    <title>PQ Monitor</title>
    <link rel='stylesheet' type='text/css' href='main.css'></link>
    <link href='http://fonts.googleapis.com/css?family=Roboto:300' rel='stylesheet' type='text/css'> 
</head>

<body>
<div id='header'>
    <ul>
        <li class='menupoint'><a class='menulink linkOverview' href="" onclick="return false;">Ãœbersicht</a></li>
        <li class='menupoint'><a class='menulink linkStatus' href="" onclick="return false;">Status</a></li>
        <li class='menupoint'><a class='menulink linkFrequency' href="" onclick="return false;">Frequenz</a></li>
        <li class='menupoint'><a class='menulink linkVoltage' href="" onclick="return false;">Spannung</a></li>
        <li class='menupoint'><a class='menulink linkHarmonics' href="" onclick="return false;">Harmonische</a></li>
        <li class='menupoint'><a class='menulink linkFlicker' href="" onclick="return false;">Flicker</a></li>
    </ul>
</div>

<div class='container'>
    <!-- Big Boxes for main graphs -->
    <div class='box bigbox voltageGraph'>
        
    </div>
    <div class='box bigbox frequencyGraph'>
        
    </div>
    <div class='box bigbox harmonicsGraph'>
        
    </div>
    <div class='box bigbox flickerGraph'>
        
    </div>
    <!-- Smaller info boxes below main graph -->
    <div class='box smallbox snippetsizeBox'>

    </div>
    <div class='box smallbox statusBox'>
        Status
        <div class='mainValue statusOK'>Messung aktiv</div>
        <table cellspacing='0' class='table'>
            <tr>
                <td>Samplerate</td>
                <td class='statusrow'><span class='statusvalue samplerate'>unknown</span>S/s</td>
            </tr>
            <tr>
                <td>CPU</td>
                <td class='statusrow'><span class='statusvalue cpuLoad'>unknown</span> %</td>
            </tr>
            <tr>
                <td>RAM</td>
                <td class='statusrow'><span class='statusvalue ramLoad'>unknown</span> %</td>
            </tr>
            <tr>
                <td>Festplatte</td>
                <td class='statusrow'><span class='statusvalue discLoad'>unknown</span> %</td>
            </tr>
            <tr>
                <td>Messzeit</td>
                <td class='statusrow'><span class='statusvalue measurement_time'>unknown</span></td>
            </tr>
        </table>
    </div>
    <div class='box smallbox freqBox'>
        Frequenz
        <div class='mainValue'><span class='frequency'>50,00</span> Hz</div>
        <table cellspacing='0' class='table'>
            <tr>
                <td>min</td>
                <td class='statusrow'><span class='statusvalue freqmin'>unknown</span> Hz</td>
            </tr>
            <tr>
                <td>max</td>
                <td class='statusrow'><span class='statusvalue freqmax'>unknown</span> Hz</td>
            </tr>
            <tr>
                <td>&empty;</td>
                <td class='statusrow'><span class='statusvalue freqaverage'>unknown</span> Hz</td>
            </tr>
            <tr>
                <td>% Norm</td>
                <td class='statusrow'><span class='statusvalue freqperc'>unknown</span> %</td>
            </tr>
        </table>

    </div>
    <div class='box smallbox voltBox'>
        Spannung
        <div class='mainValue'><span class='voltage'>230,00</span> V<span class=lower>RMS</span></div>
        <table cellspacing='0' class='table'>
            <tr>
                <td>min</td>
                <td class='statusrow'><span class='statusvalue voltmin'>unknown</span> V</td>
            </tr>
            <tr>
                <td>max</td>
                <td class='statusrow'><span class='statusvalue voltmax'>unknown</span> V</td>
            </tr>
            <tr>
                <td>&empty;</td>
                <td class='statusrow'><span class='statusvalue voltaverage'>unknown</span> V</td>
            </tr>
            <tr>
                <td>% Norm</td>
                <td class='statusrow'><span class='statusvalue voltperc'>unknown</span> %</td>
            </tr>
        </table>
    </div>
    <div class='box smallbox harmBox'>
        Harmonische
        <div class='mainValue'><span class='thd'>2,00</span> %<span class=lower>THD</span><span class='lower lowest'>U</span></div>
    </div>
    <div class='box smallbox flickerBox'>
        Flicker
        <div class='mainValue'><span class='Pst'>-</span><span class=lower> Pst</span></div>
        <div class='mainValue'><span class='Plt'>-</span><span class=lower> Plt</span></div>
    </div>
    <div class='box smallbox en50160Box'>
        EN 50160
    </div>
    <div class='box smallbox waveBox'>
        Waveform
    </div>
    <div class='box smallbox thdBox'>
        THD
    </div>
</div>

<!-- Footer Bar -->
<div class="graybar bottom">
    <ul id="footer">
        <li><a href="http://github.com/mischele/pqpico">MB</a> |
            <a href="http://github.com/kanell/pqpico">MG</a> |
            <a href="http://github.com/kipfer/pqpico">CK</a> |
            <a href="http://www.uni-stuttgart.de/ieh">IEH</a></li>
    </ul>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="http://code.highcharts.com/highcharts.js"></script>
<script>
jQuery(document).ready(function($) {
        // Initialize Graphs
        $('.snippetsizeBox').highcharts({
chart: {animation: false,zoomType: 'x', style: {fontFamily: 'Roboto'}},
            plotOptions: { series: {color: '#FF3005', marker: {enabled: false}}},
            title: {text: 'Microseconds for Computation'},
            subtitle: {text: '10 Perioden-Mittelwerte'},
            yAxis: {min:0},
            legend: {enabled: false},
            series: [{data: [] }],
            tooltip: {enabled: false}
            }).hide();

        $('.voltageGraph').highcharts({
            chart: {animation: false, zoomType: 'y', style: {fontFamily: 'Roboto'}},
            plotOptions: { series: {color: '#FF3005', marker: {enabled: false}}},
            title: {text: 'Spannung / V'},
            subtitle: {text: '10 Perioden-Mittelwerte'},
            yAxis: {min:220, max:240},
            legend: {enabled: false},
            series: [{data: [] }],
            tooltip: {enabled: false}
            }).hide();

        $('.frequencyGraph').highcharts({
            chart: {animation: false, zoomType: 'y', style: {fontFamily: 'Roboto'}},
            plotOptions: { series: {color: '#08417C', marker: {enabled: false}}},
            title: {text: 'Frequenz / Hz'},
            subtitle: {text: '10 Sekunden-Mittelwerte'},
            yAxis: {min:49.5, max:50.5},
            legend: {enabled: false},
            series: [{data: [] }]
            }).hide();

        $('.harmonicsGraph').highcharts({
            chart: {animation: true, type: 'column', style: {fontFamily: 'Roboto'}},
            plotOptions: { series: {color: '#08417C', marker: {enabled: false}, dataLabels: {enabled: true, style: {fontWeight: 'normal'}, color: 'gray'}}},
            title: {text: 'Harmonische / % (50 Hz)'},
            subtitle: {text: '10 Perioden-Mittelwerte'},
            xAxis: { categories: ['2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29','30','31','32','33','34','35','36','37','38','39','40']},
            legend: {enabled: false},
            series: [{data: [] }]
            }).hide();

        $('.waveBox').highcharts({
            chart: {animation: true, zoomType: 'xy', style: {fontFamily: 'Roboto'}},
            plotOptions: { series: {color: '#08417C', marker: {enabled: false}}},
            title: {text: 'Wellenform'},
            legend: {enabled: false},
            series: [{data: [] }],
            tooltip: {enabled: false}
            }).hide();

        $('.thdBox').highcharts({
            chart: {animation: false, zoomType: 'y', style: {fontFamily: 'Roboto'}},
            plotOptions: { series: {color: '#08417C', marker: {enabled: false}}},
            title: {text: 'Total Harmonic Distortion'},
            yAxis: {min:0, max:8},
            legend: {enabled: false},
            series: [{data: [] }],
            tooltip: {enabled: false}
            }).hide();
        
        $('.flickerGraph').highcharts({
            chart: {animation: false, style: {fontFamily: 'Roboto'}},
            plotOptions: { series: {color: '#08417C', marker: {enabled: false}}},
            legend: {enabled: false},
            series: [{data: [] }]
            }).hide();

        function clearView() {
            $('.menulink').removeClass('selected');
            $('.box').hide();
        };
        
        // Navigation
        $('.linkOverview').click(function() {
            clearView();
            $('.linkOverview').addClass('selected');
            $('.statusBox').show();
            $('.freqBox').show();
            $('.voltBox').show();
            $('.harmBox').show();
            $('.flickerBox').show();
            $('.en50160Box').show();
        });

        $('.linkStatus').click(function() {
            clearView();
            $('.linkStatus').addClass('selected');
            $('.statusBox').show();
            $('.snippetsizeBox').show();

            var snippetsizeGraph = $('.snippetsizeBox').highcharts();
            updateGraph(snippetsizeGraph,'jsondata/snippetsize.json','Snippet Size');

        });
        $('.linkFrequency').click(function() {
            clearView();
            $('.linkFrequency').addClass('selected');
            $('.freqBox').show();
            $('.frequencyGraph').show();

            var frequencyGraph = $('.frequencyGraph').highcharts();
            updateGraph(frequencyGraph,'jsondata/frequency.json','Frequenz');
        });
        $('.linkVoltage').click(function() {
            clearView();
            $('.linkVoltage').addClass('selected');
            $('.voltageGraph').show();
            $('.voltBox').fadeIn(200);

            var voltageGraph = $('.voltageGraph').highcharts();
            updateGraph(voltageGraph,'jsondata/voltage.json','Spannung');
        });
        $('.linkHarmonics').click(function() {
            clearView();
            $('.linkHarmonics').addClass('selected');
            $('.harmonicsGraph').show();
            $('.harmBox').fadeIn(200);
            $('.waveBox').show();
            $('.thdBox').show();

            var harmonicsGraph = $('.harmonicsGraph').highcharts();
            updateGraph(harmonicsGraph, 'jsondata/harmonics.json', 'Harmonische');

            var waveGraph = $('.waveBox').highcharts();
            updateGraph(waveGraph, 'jsondata/waveform.json','Spannung');

            var thdGraph = $('.thdBox').highcharts();
            updateGraph(thdGraph, 'jsondata/thd.json','THD');
        });
        $('.linkFlicker').click(function() {
            clearView();
            $('.flickerBox').fadeIn(200);
            var mainchart = $('.flickerGraph').highcharts();
        });

        function updateGraph(chart,pathString,nameString) {
            chart.series[0].remove();
            chart.addSeries({name: nameString, data:[] });
            function updateGraphRepeater() {
                $.getJSON(pathString, function(data) {
                    data = data.values;
                    chart.series[0].setData(data)
                    setTimeout(updateGraphRepeater,1000);
                });
            }
            updateGraphRepeater();
        }

        function updateInfo() {
            $.getJSON('jsondata/info.json', function(data) {
                $('.frequency').text(data.currentFreq);
                $('.voltage').text(data.currentVoltage);
                $('.thd').text(data.currentTHD);
                $('.samplerate').text(data.samplingrate);
                $('.cpuLoad').text(data.cpu);
                $('.ramLoad').text(data.ram);
                $('.discLoad').text(data.disk);
                $('.Pst').text(data.lastPst);
                $('.Plt').text(data.lastPlt);
                $('.measurement_time').text(data.measurement_time);
            });
            setTimeout(updateInfo,1000);
        };
        updateInfo();

});

</script>

</body>
</html>
