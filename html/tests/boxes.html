<html>

<head>
    <meta charset="UTF-8">
    <link rel='stylesheet' type='text/css' href='boxes.css'></link>
</head>

<body>
<div id='header'>
    <ul>
        <li class='menupoint'><a class='menulink linkStatus' href="" onclick="return false;">Status</a></li>
        <li class='menupoint'><a class='menulink linkFrequency' href="" onclick="return false;">Frequenz</a></li>
        <li class='menupoint'><a class='menulink linkVoltage' href="" onclick="return false;">Spannung</a></li>
        <li class='menupoint'><a class='menulink linkHarmonics' href="" onclick="return false;">Harmonische</a></li>
        <li class='menupoint'><a class='menulink linkFlicker' href="" onclick="return false;">Flicker</a></li>
    </ul>
</div>

<div class='container'>
    <!-- Big Boxes for main graphs -->
    <div class='box bigbox voltageGraph'>
        
    </div>
    <div class='box bigbox frequencyGraph'>
        
    </div>
    <div class='box bigbox harmonicsGraph'>
        
    </div>
    <div class='box bigbox flickerGraph'>
        
    </div>
    <!-- Smaller info boxes below main graph -->
    <div class='box smallbox statusBox'>
        <div class=statusOK>Messung aktiv</div>
    </div>
    <div class='box smallbox freqBox'>
        Frequency
    </div>
    <div class='box smallbox voltBox'>
        Voltage
    </div>
    <div class='box smallbox harmBox'>
        harmonics
    </div>
    <div class='box smallbox flickerBox'>
        Flicker
    </div>
</div>

<!-- Footer Bar -->
<div class="graybar bottom">
    <ul id="footer">
        <li><a href="http://github.com/mischele">MB</a> |
            <a href="http://github.com/kanell">MG</a> |
            <a href="http://github.com/kipfer">CK</a> |
            <a href="http://www.uni-stuttgart.de/ieh">IEH</a></li>
    </ul>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="http://code.highcharts.com/highcharts.js"></script>
<script>
jQuery(document).ready(function($) {

        $('.voltageGraph').highcharts({
            series: [{data: [1,2,3] }]
            }).hide();
        $('.frequencyGraph').highcharts({
            series: [{data: [1,2,1] }]
            }).hide();

        function clearView() {
            $('.menulink').removeClass('selected');
            $('.box').hide();
        };

        $('.linkStatus').click(function() {
            clearView();
            $('.linkStatus').addClass('selected');
            $('.statusBox').fadeIn(200);
        });
        $('.linkFrequency').click(function() {
            clearView();
            $('.linkFrequency').addClass('selected');
            $('.freqBox').show();
            $('.frequencyGraph').show();
            var frequencyGraph = $('.frequencyGraph').highcharts();
            updateGraph(frequencyGraph,'jsondata/frequency.json','Frequenz');
        });
        $('.linkVoltage').click(function() {
            clearView();
            $('.linkVoltage').addClass('selected');
            $('.voltageGraph').show();
            $('.voltBox').fadeIn(200);
            var voltageGraph = $('.voltageGraph').highcharts();
            updateGraph(voltageGraph,'jsondata/voltage.json','Spannung');
        });
        $('.linkHarmonics').click(function() {
            clearView();
            $('.linkHarmonics').addClass('selected');
            $('.box3').fadeIn(200);
            var mainchart = $('.harmonicsGraph').highcharts();
            mainchart.series[0].setData([6,7,84,6,76,7,34,45,47,56,4,76,7,3,4,5,34,3,3,23]);
            mainchart.setTitle({text: 'Harmonische 1 - 25'});
        });
        $('.linkFlicker').click(function() {
            clearView();
            $('.smallbox').hide();
            $('.box3').fadeIn(200);
            var mainchart = $('.flickerGraph').highcharts();
            mainchart.series[0].setData([6,7,84,6,76,447,34,45,447,56,4,276,7,3,4,5,34,3,23,23]);
            mainchart.setTitle({text: 'Flicker'});
        });

        function updateGraph(chart,pathString,nameString) {
            chart.series[0].remove();
            chart.addSeries({name: nameString, data:[] });
            var oldData = [];
            function updateGraphRepeater() {
                $.getJSON(pathString, function(data) {
                    data = data.freq;
                    freqdata = chart.series[0].yData;
                    console.log(freqdata);
                    console.log(data);
                    if (data.length > freqdata.length)
                    {
                        var i = freqdata.length;
                        for (; i<data.length; i++)
                        {
                            chart.series[0].addPoint(data[i],true)
                        }
                    }
                    setTimeout(updateGraphRepeater,5000);
                });
            }
            updateGraphRepeater();
        }


});

</script>

</body>
</html>
