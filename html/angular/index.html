<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="http://code.highcharts.com/highcharts.js"></script>

<link rel="stylesheet" type="text/css" href="main.css">

</head>
<body>
<!-- Menubar -->
<div class="graybar">
    <ul id="header">
        <li><a id="status" class=menuitem href="status.html" target="maingraph">Status</a></li>
        <li><a id="frequency" class=menuitem href="frequency.html" target="maingraph">Frequenz</a></li>
        <li><a id="voltage" class=menuitem href="voltage.html" target="maingraph">Spannung</a></li>
        <li><a id="harmonics" class=menuitem href="harmonics.html" target="maingraph">Harmonische</a></li>
        <li><a id="flicker" class=menuitem href="flicker.html" target="maingraph">Flicker</a></li>
    </ul>
</div>

<!-- First Graph, to be deleted -->
<div id="container"></div>

<!-- Main iframe for individual displays -->
<div id="maingraphdiv">
    <iframe name='maingraph' width=90% height=401px scrolling="no" frameborder=0 seamless></iframe>
</div>

<!-- Footer Bar -->
<div class="graybar bottom">
    <ul id="footer">
        <li><a href="mailto:beltle@ieh.uni-stuttgart.de">MB</a> |
            <a href="http://github.com/kanell">MG</a> |
            <a href="http://github.com/kipfer">CK</a> |
            <a href="http://www.uni-stuttgart.de/ieh">IEH</a></li>

    </ul>
</div>


<script>
    var vdata = [];
    console.log('Script');
    jQuery(document).ready(function($) {
        console.log('Jquery');

        $.getJSON("jsondata/frequency.json", function(data) {
            console.log('getJSON');
            console.log(data);
            vdata = data.freq;
            
            $('#container').highcharts({
                chart: {
                    type: 'line',
                    events: {
                        load: function() {
                            var series = this.series[0];
                            setInterval(function() {    $.getJSON("jsondata/frequency.json", function(data) {
                                                        vdata = data.freq; });
                                                        if (vdata.length > series.data.length)
                                                        {   var i = series.data.length;
                                                            for (; i < vdata.length; i++)  { series.addPoint(vdata[i],true,false,true); } } } ,1000);
                        },
                    }
                },
                title: {
                    text: 'Frequency of 10 periods'
                },
                xAxis: {
                    type:'datetime'
                },
                yAxis: {
                    title: {
                        text: 'Frequency / Hz',
                    },
                    plotBands: [{
                            color: '#D0D1D2',
                            from: 49.8,
                            to: 50.2}]
                },
                series: [{
                    name: 'Frequency',
                    data: vdata,
                    pointInterval : 10000 //10 seconds
                }]
            });
    });
});


jQuery(document).ready(function($) {
        $(".menuitem").click(function() {   var sitename = $(this).attr("id")+".html";
                                            $("iframe").attr("href",sitename); 
                                            console.log("Loading page "+sitename)});

        $("a").hover(
                function() {$(this).addClass("selected");},
                function() {$(this).removeClass("selected");}
                            );
        });
</script>

</body>
</html>

